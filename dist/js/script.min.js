window.onload = function () {
    document.body;

    var burgerMenu = document.querySelector(".burger-menu");
    let burgerMenuOpen = document.querySelector(".burger-menu_open");
    var closeIcon = document.querySelector(".close-icon");
    let popup = document.querySelector(".popup");
    var popupClose = document.querySelector(".popup-close");

    let form = document.getElementById("contact-form");
    let nameInput = form.querySelector(".name");
    let emailInput = form.querySelector(".email");
    let messageInput = form.querySelector("textarea");

    popupClose.addEventListener("click", function () {
        popup.style.opacity = "0";
        popup.style.top = "-250px";
    });

    burgerMenu.addEventListener("click", function () {
        burgerMenuOpen.style = "top:0;";
    });

    closeIcon.addEventListener("click", function () {
        burgerMenuOpen.style = "top:-250px";
    });

    emailjs.init("GyiJlYYijJjsag2K9");

    form.addEventListener("submit", function (e) {
        e.preventDefault();

        let isValid = validateForm();

        if (isValid) {
            let formData = {
                name: nameInput.value.trim(),
                email: emailInput.value.trim(),
                message: messageInput.value.trim(),
            };

            emailjs.send("default_service", "template_ytncs4i", formData).then(
                () => {
                    popup.style.opacity = "1";
                    popup.style.top = "50%";
                    form.reset();
                },
                () => {
                    alert("Произошла ошибка.");
                }
            );
        }
    });

    function validateForm() {
        let isValid = true;

        function clearErrors(input) {
            let error = input.nextElementSibling;
            if (error && error.classList.contains("error-message")) {
                error.remove();
            }
        }

        function showError(input, message) {
            clearErrors(input);
            let error = document.createElement("span");
            error.classList.add("error-message");
            error.style.color = "red";
            error.style.position = "absolute";
            error.style.left = "0";
            error.style.bottom = "-20px";
            error.style.fontFamily = "Poppins";
            error.style.fontSize = "12px";
            error.innerText = message;
            input.parentElement.appendChild(error);
        }

        if (nameInput.value.trim().length < 3) {
            showError(
                nameInput,
                "The name must be no shorter than 3 characters"
            );
            isValid = false;
        } else {
            clearErrors(nameInput);
        }

        let emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailPattern.test(emailInput.value.trim())) {
            showError(emailInput, "Enter a valid email address");
            isValid = false;
        } else {
            clearErrors(emailInput);
        }

        if (messageInput.value.trim().length < 10) {
            showError(
                messageInput,
                "Message must contain a minimum of 10 characters"
            );
            isValid = false;
        } else {
            clearErrors(messageInput);
        }

        return isValid;
    }
};
